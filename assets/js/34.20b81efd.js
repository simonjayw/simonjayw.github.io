(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{215:function(s,a,t){"use strict";t.r(a);var e=t(0),r=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"docker-上各种镜像的使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker-上各种镜像的使用"}},[s._v("#")]),s._v(" Docker 上各种镜像的使用")]),s._v(" "),t("h2",{attrs:{id:"jenkins"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jenkins"}},[s._v("#")]),s._v(" Jenkins")]),s._v(" "),t("p",[s._v("Jenkins 官方推荐的镜像  "),t("code",[s._v("jenkinsci/blueocean")]),s._v(" 里面捆绑了所有的blueocean")]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[s._v("$ docker run "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("d \\\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("u root \\\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p 8999:8080 \\\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p 50000:50000 \\\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("v "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("jenkins_home:"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("jenkins_home \\\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("v "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("run"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sock:"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("run"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sock \\\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("name jenkins \\\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("restart=always \\\njenkinsci"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("blueocean\n")])])]),t("p",[t("code",[s._v("-v")]),s._v(" 除了分配 jenkins 的工作目录，还分配了 docker 提供给 容器使用")]),s._v(" "),t("p",[s._v("访问容器")]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[s._v("$ docker exec "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("it jenkins bash\n")])])]),t("h3",{attrs:{id:"初始化配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#初始化配置"}},[s._v("#")]),s._v(" 初始化配置")]),s._v(" "),t("p",[s._v("拿到初始密码")]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[s._v("$ docker logs jenkins\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 或者")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("jenkins_home"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("secrets"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("initialAdminPassword\n")])])]),t("p",[s._v("到你的外网 "),t("code",[s._v("x.x.x.x:8999")]),s._v(" （可能需要配置你云服务器的防火墙）输入初始密码，配置管理员用户，安装插件")]),s._v(" "),t("h3",{attrs:{id:"ssh-配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ssh-配置"}},[s._v("#")]),s._v(" SSH 配置")]),s._v(" "),t("p",[s._v("进入到容器后")]),s._v(" "),t("ol",[t("li",[s._v("生成 ssh")])]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[s._v("$ ssh"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("keygen "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("t rsa "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("C "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"wsj_simon@163.com"')]),s._v("\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[s._v("复制到宿主机")])]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[s._v("$ docker "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" jenkins:"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ssh"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("id_rsa"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pub ~"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ssh"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n\n$ cd ~"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ssh\n\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" id_rsa"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pub >> authorized_keys\n")])])]),t("ol",{attrs:{start:"3"}},[t("li",[s._v("重启 ssh 服务")])]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[s._v("$ systemctl restart sshd"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("service\n")])])]),t("ol",{attrs:{start:"4"}},[t("li",[s._v("GitHub ssh 配置")])]),s._v(" "),t("p",[s._v("settings/SSH and GPG keys/New SSH key 新增一个 ssh key")]),s._v(" "),t("p",[s._v("PS :  配置了 ssh 之后也许还是不行，"),t("code",[s._v("jenkins The authenticity of host 'github.com (13.250.177.223)' can't be established.")]),s._v(" 或者 "),t("code",[s._v("Authentication failed")]),s._v(" 等等")]),s._v(" "),t("p",[s._v("有三种解决方法：")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("~/.ssh/known_hosts 文件添加公钥 ，如下")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("github.com,13.250.177.223 ssh-rsa AAAxxxxx....\n")])])])]),s._v(" "),t("li",[t("p",[s._v("进入到容器中，使用 "),t("code",[s._v("git clone xxxx")]),s._v("时会显示 "),t("code",[s._v("Are you sure you want to continue connecting (yes/no)?")]),s._v(" yes ，就可以会自动添加了")])]),s._v(" "),t("li",[t("p",[s._v("全局凭据配置，范围（scope）选择:"),t("code",[s._v("全局 (Jenkins, nodes, items, all child items, etc)")]),s._v(" ,类型（kind）选择："),t("code",[s._v("SSH Username with private key")]),s._v(" 。填写 username（随便填），private key 从 "),t("code",[s._v("~/.ssh/id_rsa")]),s._v(" 的内容复制。然后配置 Credentials 时，选择 这个凭据。")])])]),s._v(" "),t("h3",{attrs:{id:"使用域名访问"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用域名访问"}},[s._v("#")]),s._v(" 使用域名访问")]),s._v(" "),t("p",[s._v("可以用nginx 反向代理到 jk 的端口")]),s._v(" "),t("div",{staticClass:"language-nginx extra-class"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("                  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8998")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("             myjenkins"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    \t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8999")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("h2",{attrs:{id:"mysql"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysql"}},[s._v("#")]),s._v(" MySql")]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[s._v("$ docker run "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("name mysql \\\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("e MYSQL_ROOT_PASSWORD=123456 \\\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("d \\\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p 3306:3306 \\\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("v "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("conf:"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("conf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d \\\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("v "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("data")]),s._v(":"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql \\\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("restart=always \\\nmysql\n")])])]),t("p",[t("code",[s._v("-e MYSQL_ROOT_PASSWORD=123456")]),s._v(" 设置 root 用户密码")]),s._v(" "),t("p",[t("code",[s._v("-d")]),s._v(" 后台运行")]),s._v(" "),t("p",[t("code",[s._v("-p 3306:3306")]),s._v(" 指定端口")]),s._v(" "),t("p",[t("code",[s._v("--restart=always")]),s._v(" docker 重启后，容器自动启动")]),s._v(" "),t("p",[t("code",[s._v("--privileged=true")]),s._v(" 容器内的root拥有真正root权限，否则容器内root只是外部普通用户权限")]),s._v(" "),t("p",[t("code",[s._v("-v")]),s._v(" 挂在目录")]),s._v(" "),t("p",[s._v("mysql 的默认配置文件"),t("code",[s._v("/etc/mysql/my.cnf")]),s._v(" "),t("code",[s._v("/etc/mysql/conf.d")]),s._v("  后者是个文件夹，权限大于前者。文件夹中可以命名任意 "),t("code",[s._v("xxx.cnf")]),s._v(" 来覆盖 "),t("code",[s._v("my.cnf")])]),s._v(" "),t("p",[s._v("Mysql 的数据默认存放在 "),t("code",[s._v("/var/lib/mysql")]),s._v(" 中")]),s._v(" "),t("p",[s._v("进入")]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入容器")]),s._v("\n$ docker exec "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("it mysql bash\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 登陆输入上面的密码")]),s._v("\n$ mysql "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("u root "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p\n")])])]),t("h3",{attrs:{id:"远程访问权限"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#远程访问权限"}},[s._v("#")]),s._v(" 远程访问权限")]),s._v(" "),t("p",[s._v("这里需要有个用户的概念。root 用户没有开放远程访问权限。而是另外创建了一个 simon 用户，授予远程访问。")]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加进入到mysql容器内部才能执行命令设置远程登陆账号密码")]),s._v("\n$ CREATE USER "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'simon'")]),s._v("@"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%'")]),s._v(" IDENTIFIED WITH mysql_native_password BY "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'123456'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启远程访问权限")]),s._v("\n$ GRANT ALL PRIVILEGES ON "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" TO "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'simon'")]),s._v("@"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 刷新权限")]),s._v("\n$ flush privileges"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    \n")])])]),t("p",[s._v("配置 conf 文件使得外部可以连接，记得开放防火墙")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("[mysqld]\n\nbind-address = 0.0.0.0\n")])])]),t("h2",{attrs:{id:"mongodb"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mongodb"}},[s._v("#")]),s._v(" MongoDB")]),s._v(" "),t("h3",{attrs:{id:"运行"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#运行"}},[s._v("#")]),s._v(" 运行")]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[s._v("$ docker run "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("name mongo "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("d "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p 27017:27017 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("v "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mongo"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("conf:"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mongo "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("v "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mongo"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("data")]),s._v(":"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("data")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("db "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("restart=always mongo "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("auth "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("config "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mongo"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mongod"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf\n")])])]),t("p",[s._v("docker run --name mongo -d -p 27017:27017 mongo --auth")]),s._v(" "),t("p",[s._v("mongo 配置")]),s._v(" "),t("p",[t("code",[s._v("--auth")]),s._v(" 需要密码才能访问容器服务")]),s._v(" "),t("p",[s._v("Mongoldb 的默认配置文件"),t("code",[s._v("/etc/mongo/mongod.conf")])]),s._v(" "),t("p",[s._v("Mongoldb 的数据默认存放在 "),t("code",[s._v("/data/db")]),s._v(" 中")]),s._v(" "),t("h3",{attrs:{id:"进入与用户"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#进入与用户"}},[s._v("#")]),s._v(" 进入与用户")]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[s._v("docker exec "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("it mongo mongo admin\n")])])]),t("p",[s._v("以admin 的身份登陆 mongo")]),s._v(" "),t("p",[s._v("创建 admin")]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[s._v("db"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("createUser"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" user:"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'admin'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("pwd")]),s._v(":"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'123456'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("roles:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" role:"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'root'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" db: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'admin'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[s._v("使用用户登陆")]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[s._v("db"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("auth"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'admin'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'123456'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),t("p",[s._v("指定某个数据库的用户权限")]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[s._v("use test\ndb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("createUser"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tuser: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'testUser'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("pwd")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'testPwd'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\troles: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'readWrited'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),t("h3",{attrs:{id:"远程连接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#远程连接"}},[s._v("#")]),s._v(" 远程连接")]),s._v(" "),t("p",[s._v("配置 conf 文件使得外部可以连接。好像不配置也可以，但是记得配置防火墙")]),s._v(" "),t("div",{staticClass:"language-conf extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("net:\n   bindIp: 0.0.0.0\n   port: 27017\n")])])]),t("h2",{attrs:{id:"redis"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis"}},[s._v("#")]),s._v(" Redis")]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[s._v("$ docker run "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("name redis "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("d "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p 6379:6379 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("v "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("redis"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("conf"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("redis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf:"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("redis"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("redis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("v "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("redis"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("data")]),s._v(":"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("data")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("restart=always redis redis"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("server "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("redis"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("redis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("appendonly yes\n")])])]),t("p",[t("code",[s._v("redis-server xx.conf --appendonly yes")])]),s._v(" "),t("p",[s._v("启动 redis 服务器，")]),s._v(" "),t("p",[s._v("xx.conf 指定配置文件，")]),s._v(" "),t("p",[s._v("appendonly 打开Redis持久化配置。")]),s._v(" "),t("p",[s._v("Redis 默认配置文件下载 http://download.redis.io/releases/")]),s._v(" "),t("p",[s._v("Redis 的默认配置文件 "),t("code",[s._v("/usr/local/etc/redis/redis.conf")])]),s._v(" "),t("p",[s._v("Redis 的数据默认存放在 "),t("code",[s._v("/data")])]),s._v(" "),t("p",[s._v("设置 conf 文件下的 "),t("code",[s._v("requirepass yourpassword")])]),s._v(" "),t("h3",{attrs:{id:"进入容器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#进入容器"}},[s._v("#")]),s._v(" 进入容器")]),s._v(" "),t("div",{staticClass:"language-powershell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-powershell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用 redis-cli")]),s._v("\n$ docker exec "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("it redis redis"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cli")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取权限操作")]),s._v("\n$ auth yourpassword\n")])])]),t("h3",{attrs:{id:"远程连接-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#远程连接-2"}},[s._v("#")]),s._v(" 远程连接")]),s._v(" "),t("p",[s._v("可以下载客户端 "),t("a",{attrs:{href:"https://github.com/qishibo/AnotherRedisDesktopManager",target:"_blank",rel:"noopener noreferrer"}},[s._v("AnotherRedisDesktopManager"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("远程连接需要修改conf文件。我这里只修改了 bind 就可以，如果不可以再添加 protected-mode")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("daemonize no\nbind 0.0.0.0\nprotected-mode no\n")])])]),t("p",[t("code",[s._v("daemonize no")]),s._v(" 在Docker中后台启动一个镜像，当前台无响应时会自动退出。Redis 进程被后台化后， 启动Redis的那个进程，也就是Docker执行进程无事可做，因此Docker执行进程退出。当然如果你的Redis的配置文件中没有后台运行，就不会出现这种状况。将Redis的后台运行改为"),t("code",[s._v("no")]),s._v("，这样就完成了。")])])}),[],!1,null,null,null);a.default=r.exports}}]);